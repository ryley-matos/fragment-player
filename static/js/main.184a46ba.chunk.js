(this["webpackJsonpfragment-player-example"]=this["webpackJsonpfragment-player-example"]||[]).push([[0],{14:function(e,t,n){"use strict";n.r(t);n(9);var r=n(0),a=n.n(r),o=n(7),i=n.n(o),u=n(5),c=n(3),l=n(4);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var f=function(e,t){return e.findIndex((function(e){var n=e.startAt,r=e.endAt;return t>=n&&t<=r}))},s=a.a.createContext({});var g=function(e){var t=e.children,n=e.fragments,o=e.loadVideo,i=Object(r.useRef)(),u=Object(r.useRef)(),c=Object(r.useRef)(),l=Object(r.useRef)({tmpPlaying:void 0,timeout:void 0}),v=Object(r.useState)(!1),g=v[0],p=v[1],b=Object(r.useState)(0),y=b[0],h=b[1],E=Object(r.useMemo)((function(){return function(e){var t=0,n=null===e||void 0===e?void 0:e.map((function(e){var n=e.fragmentEnd-e.fragmentBegin,r=d({},e,{startAt:t,endAt:t+n});return t+=n,r}));return{totalLength:t,enrichedFragments:n}}(n)}),[n]),O=E.totalLength,j=E.enrichedFragments,w=f(j,y),S=Object(r.useState)({}),A=S[0],B=A.width,k=A.height,C=S[1],I=Object(r.useState)(!1),P=I[0],T=I[1],L=Object(r.useState)(-1),x=L[0],V=L[1];Object(r.useEffect)((function(){var e=document.createElement("div");return e.style.display="none",e.id="fragment-dummy",document.body.appendChild(e),function(){return document.body.removeChild(e)}}),[]);var R=function(e){V(e)},F=function(){g?(p(!1),W[w].pause()):(p(!0),W[w].play())},M=o?a.a.createElement("div",{style:{width:"100%",height:"100%"},ref:u},a.a.createElement("canvas",{ref:i,style:{width:"100%"},onClick:F})):null;Object(r.useLayoutEffect)((function(){var e=function(){var e,t;C({width:null===u||void 0===u||null===(e=u.current)||void 0===e?void 0:e.clientWidth,height:null===u||void 0===u||null===(t=u.current)||void 0===t?void 0:t.clientHeight})};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}})),Object(r.useEffect)((function(){var e,t;C({width:null===u||void 0===u||null===(e=u.current)||void 0===e?void 0:e.clientWidth,height:null===u||void 0===u||null===(t=u.current)||void 0===t?void 0:t.clientHeight})}),[null===i||void 0===i?void 0:i.current,null===u||void 0===u?void 0:u.current,o,P]);var W=Object(r.useMemo)((function(){return T(!1),o?null===j||void 0===j?void 0:j.map((function(e,t){var n=e.fragmentBegin+"-"+e.fragmentEnd+"-"+e.src,r=document.getElementById(n),a=r||document.createElement("video");(t||r?t||(T(!0),R(t)):(a.src=e.src,a.preload="auto",a.currentTime=e.fragmentBegin,a.load(),a.onloadeddata=function(){T(!0),R(t)}),r)||(a.id=n,document.getElementById("fragment-dummy").appendChild(a));return a})):[]}),[j,null===i||void 0===i?void 0:i.current,o]);Object(r.useEffect)((function(){var e=x+1,t=W[e],n=j[e];t&&(t.src=n.src,t.preload="auto",t.currentTime=n.fragmentBegin,t.load(),t.onloadeddata=function(){R(e)})}),[x]),Object(r.useEffect)((function(){var e=W[w];if(e){var t=function(){return e.play()};return g&&e&&e.addEventListener("canplay",t),function(){e.pause(),e.removeEventListener("canplay",t)}}}),[j,w,g,W]);var z=function(e){var t;void 0===(null===l||void 0===l||null===(t=l.current)||void 0===t?void 0:t.tmpPlaying)&&(l.current.tmpPlaying=g),p(!1),clearTimeout(l.current.timeout),l.current.timeout=setTimeout((function(){var e;p(null===l||void 0===l||null===(e=l.current)||void 0===e?void 0:e.tmpPlaying),l.current.tmpPlaying=void 0}),e)};return Object(r.useEffect)((function(){g&&W[w].play()}),[w,y,g]),Object(r.useEffect)((function(){for(var e,t,n=m(W);!(t=n()).done;){t.value.pause()}if(W[w]&&P&&(null===i||void 0===i?void 0:i.current)&&M){var r=j[w];W[w].currentTime=y-r.startAt+(null===r||void 0===r?void 0:r.fragmentBegin),i.current.width=B,i.current.height=k;var a=null===i||void 0===i||null===(e=i.current)||void 0===e?void 0:e.getContext("2d");a.drawImage(W[w],0,0,B,k),clearInterval(null===c||void 0===c?void 0:c.current),c.current=setInterval((function(){var e,t,n,r=(null===(e=W[w])||void 0===e?void 0:e.currentTime)-(null===(t=j[w])||void 0===t?void 0:t.fragmentBegin)+(null===(n=j[w])||void 0===n?void 0:n.startAt);r>=O?(h(O),F()):r<=0?(h(0),F()):h(r),a.drawImage(W[w],0,0,B,k)}),30)}}),[j,w,B,k,P]),Object(r.useEffect)((function(){!o&&W&&p(!1)}),[o,W,null===u||void 0===u?void 0:u.current]),a.a.createElement(s.Provider,{value:{seekTo:function(e){if(z(100),f(j,y)===w){var t=j[w];W[w].currentTime=e-t.startAt+(null===t||void 0===t?void 0:t.fragmentBegin)}h(e)},togglePlay:F,setPlaying:p,ready:P,currentTime:y,totalLength:O,video:M,videos:W,playing:g,currentVideoIdx:w,tmpPause:z}},t)},p=[{src:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4",fragmentBegin:0,fragmentEnd:5},{src:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4",fragmentBegin:1,fragmentEnd:25},{src:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4",fragmentBegin:1,fragmentEnd:3}],b=function(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(!1),d=Object(l.a)(i,2),v=d[0],m=d[1];return a.a.createElement(g,{fragments:v?[].concat(Object(c.a)(p.slice(0,1)),[Object(u.a)(Object(u.a)({},p[1]),{},{fragmentEnd:p[1].fragmentEnd+10})],Object(c.a)(p.slice(2))):p,loadVideo:n},a.a.createElement(s.Consumer,null,(function(e){var t=e.seekTo,n=e.currentTime,r=e.totalLength,i=e.video,u=e.setPlaying,c=e.ready;return a.a.createElement("div",{style:{width:"75%",margin:"auto"}},a.a.createElement("button",{onClick:function(){return o(!0)}},"Show Video"),a.a.createElement("button",{onClick:function(){return m(!v)}},"Simulate Edit"),a.a.createElement("button",{onClick:function(){return u(!0)}},"Play"),a.a.createElement("button",{onClick:function(){return u(!1)}},"Pause"),i,a.a.createElement("input",{style:{width:"100%"},type:"range",min:0,max:r,value:n,onChange:function(e){return t(parseInt(e.target.value))}}),a.a.createElement("div",null,c?"Video Ready":"Video Loading..."))})))};i.a.render(a.a.createElement(b,null),document.getElementById("root"))},8:function(e,t,n){e.exports=n(14)},9:function(e,t,n){}},[[8,1,2]]]);
//# sourceMappingURL=main.184a46ba.chunk.js.map